<!DOCTYPE html>
<html>
<head>
  <title>Roeselare Neerslag</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #map {
      height: 600px;
      width: 100%;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h2>Roeselare Neerslag – Geef je meting door</h2>
  <p>Klik op de kaart en geef de neerslag van gisteren in (mm).</p>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Kaart initialiseren
    var map = L.map('map').setView([50.9480, 3.1163], 12);

    // OpenStreetMap laag
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);

    var marker = null;

    map.on('click', function (e) {

      if (marker) {
        alert("Je kunt maar één meting per bezoek ingeven.");
        return;
      }

      var regen = prompt("Geef de neerslag van gisteren in (mm):");

      // Validatie
      if (regen === null || regen === "" || isNaN(regen) || regen < 0 || regen > 200) {
        alert("Ongeldige invoer. Geef een getal tussen 0 en 200 mm.");
        return;
      }

      marker = L.marker(e.latlng).addTo(map);

      // Datum in correct formaat
      var datum = new Date().toISOString().split("T")[0];

      // URL correct opbouwen
      var url =
        "https://script.google.com/macros/s/AKfycbxNsWmyc9Oha_jfECuFsHmyNrwAlxfXufi2OdOmewjahq2MLQY3m-UyXjr_aDbzy63E/exec"
        + "?datum=" + encodeURIComponent(datum)
        + "&lat=" + encodeURIComponent(e.latlng.lat)
        + "&lng=" + encodeURIComponent(e.latlng.lng)
        + "&neerslag=" + encodeURIComponent(regen);

      // Debug (heel belangrijk)
      console.log("VERSTUURDE URL:", url);

      fetch(url)
        .then(response => response.text())
        .then(text => {
          console.log("SERVER ANTWOORD:", text);
          alert("Bedankt! Je neerslag is geregistreerd.");
        })
        .catch(error => {
          console.error("FETCH ERROR:", error);
          alert("Er ging iets mis bij het verzenden.");
          map.removeLayer(marker);
          marker = null;
        });
    });
  </script>

</body>
</html>
