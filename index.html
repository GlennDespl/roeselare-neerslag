<!DOCTYPE html>
<html>
<head>
  <title>Roeselare Neerslag</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 600px; width: 100%; }
  </style>
</head>
<body>
  <h2>Roeselare Neerslag – Geef je meting door</h2>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Maak de kaart aan, gecentreerd op Roeselare
    var map = L.map('map').setView([50.9480, 3.1163], 12);

    // Laag toevoegen (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    var marker;
    map.on('click', function(e) {
        if (!marker) {
            marker = L.marker(e.latlng).addTo(map);

            // Vraag neerslaghoeveelheid
            var regen = prompt("Geef de neerslag van gisteren in (mm):");
            if (regen != null && !isNaN(regen)) {
                // Hier kun je data naar Google Sheet sturen via een web-app of Form submission
                fetch("https://script.google.com/macros/s/AKfycbxNsWmyc9Oha_jfECuFsHmyNrwAlxfXufi2OdOmewjahq2MLQY3m-UyXjr_aDbzy63E/exec" + new Date().toLocaleDateString() + "&lat=" + e.latlng.lat + "&lng=" + e.latlng.lng + "&neerslag=" + regen)
                .then(response => response.text())
                .then(data => {
                    alert("Bedankt! Je neerslag is geregistreerd.");
                })
                .catch(err => {
                    alert("Er ging iets mis bij het verzenden. Probeer later opnieuw.");
                    console.error(err);
                    map.removeLayer(marker);
                    marker = null;
                });
            } else {
                alert("Ongeldige invoer. Probeer opnieuw.");
                map.removeLayer(marker);
                marker = null;
            }
        } else {
            alert("Je kunt slechts één locatie per dag aangeven. Verplaats de bestaande marker indien nodig.");
        }
    });
  </script>
</body>
</html>
